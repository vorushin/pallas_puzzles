<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 780 420" font-family="monospace" font-size="12">
  <rect width="780" height="420" fill="white"/>

  <!-- Title -->
  <text x="390" y="25" text-anchor="middle" fill="#111827" font-weight="bold" font-size="15">Splash Attention: Compacted Iteration</text>

  <!-- LEFT: Regular grid -->
  <text x="150" y="55" text-anchor="middle" fill="#6b7280" font-weight="bold" font-size="12">Regular Grid (Puzzle 7)</text>

  <!-- Left grid - 4×4 causal -->
  <!-- Row 0: P S S S -->
  <rect x="50" y="70" width="45" height="45" rx="2" fill="#fef9c3" stroke="#eab308" stroke-width="1"/>
  <text x="72" y="98" text-anchor="middle" fill="#854d0e" font-size="10">P</text>
  <rect x="100" y="70" width="45" height="45" rx="2" fill="#fee2e2" stroke="#fca5a5" stroke-width="1"/>
  <text x="122" y="98" text-anchor="middle" fill="#b91c1c" font-size="10">S</text>
  <rect x="150" y="70" width="45" height="45" rx="2" fill="#fee2e2" stroke="#fca5a5" stroke-width="1"/>
  <text x="172" y="98" text-anchor="middle" fill="#b91c1c" font-size="10">S</text>
  <rect x="200" y="70" width="45" height="45" rx="2" fill="#fee2e2" stroke="#fca5a5" stroke-width="1"/>
  <text x="222" y="98" text-anchor="middle" fill="#b91c1c" font-size="10">S</text>

  <!-- Row 1: F P S S -->
  <rect x="50" y="120" width="45" height="45" rx="2" fill="#dcfce7" stroke="#22c55e" stroke-width="1"/>
  <text x="72" y="148" text-anchor="middle" fill="#166534" font-size="10">F</text>
  <rect x="100" y="120" width="45" height="45" rx="2" fill="#fef9c3" stroke="#eab308" stroke-width="1"/>
  <text x="122" y="148" text-anchor="middle" fill="#854d0e" font-size="10">P</text>
  <rect x="150" y="120" width="45" height="45" rx="2" fill="#fee2e2" stroke="#fca5a5" stroke-width="1"/>
  <text x="172" y="148" text-anchor="middle" fill="#b91c1c" font-size="10">S</text>
  <rect x="200" y="120" width="45" height="45" rx="2" fill="#fee2e2" stroke="#fca5a5" stroke-width="1"/>
  <text x="222" y="148" text-anchor="middle" fill="#b91c1c" font-size="10">S</text>

  <!-- Row 2: F F P S -->
  <rect x="50" y="170" width="45" height="45" rx="2" fill="#dcfce7" stroke="#22c55e" stroke-width="1"/>
  <text x="72" y="198" text-anchor="middle" fill="#166534" font-size="10">F</text>
  <rect x="100" y="170" width="45" height="45" rx="2" fill="#dcfce7" stroke="#22c55e" stroke-width="1"/>
  <text x="122" y="198" text-anchor="middle" fill="#166534" font-size="10">F</text>
  <rect x="150" y="170" width="45" height="45" rx="2" fill="#fef9c3" stroke="#eab308" stroke-width="1"/>
  <text x="172" y="198" text-anchor="middle" fill="#854d0e" font-size="10">P</text>
  <rect x="200" y="170" width="45" height="45" rx="2" fill="#fee2e2" stroke="#fca5a5" stroke-width="1"/>
  <text x="222" y="198" text-anchor="middle" fill="#b91c1c" font-size="10">S</text>

  <!-- Row 3: F F F P -->
  <rect x="50" y="220" width="45" height="45" rx="2" fill="#dcfce7" stroke="#22c55e" stroke-width="1"/>
  <text x="72" y="248" text-anchor="middle" fill="#166534" font-size="10">F</text>
  <rect x="100" y="220" width="45" height="45" rx="2" fill="#dcfce7" stroke="#22c55e" stroke-width="1"/>
  <text x="122" y="248" text-anchor="middle" fill="#166534" font-size="10">F</text>
  <rect x="150" y="220" width="45" height="45" rx="2" fill="#dcfce7" stroke="#22c55e" stroke-width="1"/>
  <text x="172" y="248" text-anchor="middle" fill="#166534" font-size="10">F</text>
  <rect x="200" y="220" width="45" height="45" rx="2" fill="#fef9c3" stroke="#eab308" stroke-width="1"/>
  <text x="222" y="248" text-anchor="middle" fill="#854d0e" font-size="10">P</text>

  <!-- Left label -->
  <text x="150" y="290" text-anchor="middle" fill="#b91c1c" font-size="11">16 iterations</text>
  <text x="150" y="305" text-anchor="middle" fill="#b91c1c" font-weight="bold" font-size="11">6 wasted on SKIP</text>

  <!-- BIG ARROW -->
  <line x1="270" y1="165" x2="360" y2="165" stroke="#7c3aed" stroke-width="3" marker-end="url(#bigarr)"/>
  <text x="315" y="150" text-anchor="middle" fill="#7c3aed" font-weight="bold" font-size="11">data_next</text>
  <text x="315" y="190" text-anchor="middle" fill="#7c3aed" font-size="10">maps steps</text>
  <text x="315" y="205" text-anchor="middle" fill="#7c3aed" font-size="10">→ KV blocks</text>

  <!-- RIGHT: Compacted grid -->
  <text x="560" y="55" text-anchor="middle" fill="#6b7280" font-weight="bold" font-size="12">Compacted Grid (Splash)</text>

  <!-- Row labels -->
  <text x="395" y="98" fill="#6b7280" font-size="10">i=0</text>
  <text x="395" y="148" fill="#6b7280" font-size="10">i=1</text>
  <text x="395" y="198" fill="#6b7280" font-size="10">i=2</text>
  <text x="395" y="248" fill="#6b7280" font-size="10">i=3</text>

  <!-- Step labels -->
  <text x="445" y="68" text-anchor="middle" fill="#6b7280" font-size="9">step 0</text>
  <text x="515" y="68" text-anchor="middle" fill="#6b7280" font-size="9">step 1</text>
  <text x="585" y="68" text-anchor="middle" fill="#6b7280" font-size="9">step 2</text>
  <text x="655" y="68" text-anchor="middle" fill="#6b7280" font-size="9">step 3</text>

  <!-- Compacted Row 0: 1 block -->
  <rect x="420" y="75" width="50" height="40" rx="2" fill="#fef9c3" stroke="#eab308" stroke-width="1.5"/>
  <text x="445" y="98" text-anchor="middle" fill="#854d0e" font-size="9">kv=0</text>

  <!-- Compacted Row 1: 2 blocks -->
  <rect x="420" y="125" width="50" height="40" rx="2" fill="#dcfce7" stroke="#22c55e" stroke-width="1.5"/>
  <text x="445" y="148" text-anchor="middle" fill="#166534" font-size="9">kv=0</text>
  <rect x="490" y="125" width="50" height="40" rx="2" fill="#fef9c3" stroke="#eab308" stroke-width="1.5"/>
  <text x="515" y="148" text-anchor="middle" fill="#854d0e" font-size="9">kv=1</text>

  <!-- Compacted Row 2: 3 blocks -->
  <rect x="420" y="175" width="50" height="40" rx="2" fill="#dcfce7" stroke="#22c55e" stroke-width="1.5"/>
  <text x="445" y="198" text-anchor="middle" fill="#166534" font-size="9">kv=0</text>
  <rect x="490" y="175" width="50" height="40" rx="2" fill="#dcfce7" stroke="#22c55e" stroke-width="1.5"/>
  <text x="515" y="198" text-anchor="middle" fill="#166534" font-size="9">kv=1</text>
  <rect x="560" y="175" width="50" height="40" rx="2" fill="#fef9c3" stroke="#eab308" stroke-width="1.5"/>
  <text x="585" y="198" text-anchor="middle" fill="#854d0e" font-size="9">kv=2</text>

  <!-- Compacted Row 3: 4 blocks -->
  <rect x="420" y="225" width="50" height="40" rx="2" fill="#dcfce7" stroke="#22c55e" stroke-width="1.5"/>
  <text x="445" y="248" text-anchor="middle" fill="#166534" font-size="9">kv=0</text>
  <rect x="490" y="225" width="50" height="40" rx="2" fill="#dcfce7" stroke="#22c55e" stroke-width="1.5"/>
  <text x="515" y="248" text-anchor="middle" fill="#166534" font-size="9">kv=1</text>
  <rect x="560" y="225" width="50" height="40" rx="2" fill="#dcfce7" stroke="#22c55e" stroke-width="1.5"/>
  <text x="585" y="248" text-anchor="middle" fill="#166534" font-size="9">kv=2</text>
  <rect x="630" y="225" width="50" height="40" rx="2" fill="#fef9c3" stroke="#eab308" stroke-width="1.5"/>
  <text x="655" y="248" text-anchor="middle" fill="#854d0e" font-size="9">kv=3</text>

  <!-- Right label -->
  <text x="560" y="290" text-anchor="middle" fill="#166534" font-size="11">10 iterations</text>
  <text x="560" y="305" text-anchor="middle" fill="#166534" font-weight="bold" font-size="11">0 wasted!</text>

  <!-- Bottom explanation -->
  <rect x="140" y="330" width="500" height="75" rx="8" fill="#f5f3ff" stroke="#7c3aed" stroke-width="1.5"/>
  <text x="390" y="355" text-anchor="middle" fill="#5b21b6" font-weight="bold" font-size="12">PrefetchScalarGridSpec</text>
  <text x="390" y="375" text-anchor="middle" fill="#6d28d9" font-size="11">data_next[i, step] → which KV block to load at each step</text>
  <text x="390" y="393" text-anchor="middle" fill="#6d28d9" font-size="11">Index maps use data_next to route K,V to the right block</text>

  <defs>
    <marker id="bigarr" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#7c3aed"/>
    </marker>
  </defs>
</svg>